# Plugin Platform

Платформа для запуска различных адаптеров в рамках одного платформенного приложения.

API -- http://localhost/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config


## Мотивация

Proof-of-Concept для платформы запуска типовых плагинов (интеграций, задач и пр.) в рамках одного Java приложения.

Аналогичное можно сделать через микросервис на каждый плагин или система распределенных вычислений (к примеру Ignite).
Но микросервис по плагину при значительном их числе будет требовать много ресурсов или внешний шедулер, который должен их 
разворачивать перед работой и сворачивать после. Этого можно добиться через API K8S, но каждое приложение все равно будет требовать 
значительных ресурсов.
А Ignite или другие распределенные системы являются еще одной сложной платформой поверх которой придется разворачивать данные.

По факту является мини-шиной, с очень ограниченным функционалом.
Альтернативой можно назвать OSGi.


## HLD

Есть ядро (это приложение) и набор плагинов, которые реализуют интерфейс Plugin.
Каждый плагин реализует свою уникальную логику (обращение\задачи\...).
При вызове ядро пытается найти загруженные плагины в кеше, и если их там нет, пытается загрузить новый плагин.
Если плагин найден -- ему передается запрос и получается ответ.

Схему работы см. в workflow.puml


## TODO

* Сделать загрузчик не просто с Autowired бинов, а каждый плагин делать бином и все его внутренние классы
  * Для этого нужно засунуть его в спринговый контекст и вручную создать все бины
  * По факту -- своя BeanFactory
  * Плюс см https://stackoverflow.com/questions/53961633/how-to-control-spring-context-initialization-errors 
    и https://stackoverflow.com/questions/27809838/how-to-instantiate-spring-managed-beans-at-runtime

* Вынести общие DTO (пакет `dev.alnat.plugin_platform.plugin`) в отдельный Maven репозиторий и подключать как зависимость
  во все проекты

* Разнести плагины в отдельные подпроекты\модули Maven

* PluginConfig вынести из `application.yml` в отдельный загрузчик из реестра

* Сделать E2E тест со сборкой нескольких проектов и запуском их в тестовом режиме
